# go_eml

Простая демонстрационная панель на Go с аккуратным оформлением и базовым JavaScript. По умолчанию авторизация `admin/admin`.

## Запуск на Ubuntu
```bash
sudo apt update
sudo apt install -y golang-go mysql-server libreoffice
sudo service mysql start
mysql -u root -e "CREATE DATABASE IF NOT EXISTS go_eml;"
export MYSQL_DSN="root:@tcp(127.0.0.1:3306)/go_eml?parseTime=true"
cd /path/to/go_eml
go run .
```
После запуска откройте в браузере `http://localhost:8080`.

## Запуск на Windows
1. Установите [Go](https://go.dev/dl/), MySQL и LibreOffice.
2. Создайте базу `go_eml` и настройте строку подключения, напр. `set MYSQL_DSN=user:pass@tcp(127.0.0.1:3306)/go_eml?parseTime=true`.
3. Откройте командную строку и перейдите в каталог проекта.
4. Выполните:
    ```cmd
    go run .
    ```
5. В браузере откройте `http://localhost:8080`.

Проект содержит вкладки:
- Письмо (отправляет письмо через API первого доступного аккаунта)
  Можно указать количество получателей и выбрать, в какое поле (TO/CC/BCC) их вставлять; есть опция отправить первого в TO, остальных в выбранное поле.
  Запуск массовой отправки осуществляется кнопкой «Запустить отправку», процесс можно остановить кнопкой «Стоп». Отправленные адреса помечаются и не берутся повторно.
  Под формой отображается подробный лог всех запросов и ответов, индикатор прогресса и счётчик ошибок с возможностью скачать журнал. Логи можно очистить отдельной кнопкой.
- База e-mail (поддерживает загрузку файла с выбором формата строк и удаление записей)
  Перед загрузкой файла выберите формат строк (`Имя <login@domen.ru>`, `Имя <login@domen.ru>;` или `login@domen.ru`).
  На странице можно сбросить статусы отправки для всех адресов.
- Макросы (счётчики, рандомные строки и списки из файла, обновляемые каждые N писем; значения автоматически подставляются в тему и текст письма)
  Поддерживается тип «Мультимакрос» с комбинированием других макросов и кодированием результата (Base64 или QUOTED-PRINTABLE).
- Аттачи (изображения можно встраивать внутрь письма; при необходимости к ним добавляются случайные отступы и цветные точки. Для DOCX поддерживается добавление случайных страниц, вставка текста с макросами и опциональная конвертация в PDF. Для конвертации используется установленный в системе `libreoffice`, что сохраняет исходное содержимое документа. В процессе загрузки из файла удаляются неподдерживаемые отношения `stylesWithEffects` из корневых `.rels`, предотвращая ошибки чтения. Для каждого файла выдаются макросы `{{$attach_N}}` и `{{$attach_img_N_base64}}` для HTML)
- API правила
- Прокси (загрузка файла, автоматическая проверка через `api.ipify.org` и пометка состояния; при сбое прокси запрос повторяется до трёх раз, после чего выбирается новый)
- Аккаунты API (поддерживает загрузку файла формата `login:pass:Имя:Фамилия:API_KEY:uuid`)
- Настройки (домен, User-Agent, лимит писем на аккаунт и цикл, смена пароля)
  Можно задать количество потоков отправки. При запуске массовой отправки создаётся пул рабочих горутин, каждая забирает новый пакет адресов и использует свободный аккаунт. Это исключает отправку одного письма несколькими потоками и соблюдает лимиты на количество писем с каждого аккаунта.
  Добавлен email для проверки доставки и интервал, после скольких отправок отправлять тестовое письмо.

При отправке письма аккаунт автоматически получает первый рабочий прокси из списка.

При отправке письма панель сначала проверяет выбранный аккаунт запросом `reset_fresh`, затем получает `operation_id` через `generate_operation_id` и лишь после этого делает `send`.

Для каждого аккаунта ведётся счётчик отправок. Если он достигает заданного лимита, панель переключается на следующий аккаунт. Счётчики можно сбросить на вкладке «Аккаунты API».
Если свободных аккаунтов не осталось, массовая отправка прекращается.
Все данные сохраняются в MySQL. Перед запуском поднимите сервер MySQL и создайте базу `go_eml`,
затем задайте строку подключения в переменной окружения `MYSQL_DSN` (например,
`export MYSQL_DSN=user:pass@tcp(127.0.0.1:3306)/go_eml?parseTime=true`).
