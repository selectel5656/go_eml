# go_eml
go_eml

Все должно открываться в браузере, это панель должна быть доступка с браузера как веб сайт.
Работать все на Go

Обрати внимание в описании тут User-Agent: ru.XXXX.XXXX/XXXX.XXXX (iPhone12,1; iOS 16.5.1) это просто для описания,
по факту юзер агент должен быть другой и настраиваться во вкладке настройки и там его прописывать!

Обязательно напиши инструкцию как запустить это на виндовс для тестов чтобы отрывать в браузере панель и на убунту на удаленном сервере чтобы открыть с браузера панель.

В панели во всех вкладках если что то добавляем надо чтобы была возможность также и удалить.

Вход в панель должен быть по логину и паролю по умолчанию это пусть будет admin/admin

В панеле управления должны быть разные вкладки:
1. Письмо
2. База емайл
3. Макросы
4. Аттачи
5. api правила
6. Прокси
7. Аккаунты API

Вкладка «Письмо»
На вкладке располагаются поля и настройки для формирования и отправки письма. Поля для заполнения:
Тема сообщения. 
Текст сообщения. 
Аттачи – выбор вложений из вкладки «Аттачи».
Если вложение – картинка, и в её настройках указано «Использовать внутри письма», рядом отображается:
макрос вложения (например: {{$attach_img_1_base64}}) для вставки в текст письма (HTML);
пример итогового HTML-кода для вставки:
<img src="data:image/png;base64,{{$img_1_base64}}">
Настройки отправки:
Количество писем, отправляемых с одного аккаунта перед его сменой (N). После достижения этого количества система автоматически переключается на следующий аккаунт. (Данный параметр определяет лимит использования одного аккаунта в рамках сессии. По достижении заданного количества отправленных писем аккаунт сменяется автоматически.)
Гонять аккаунты по кругу если они закончились и выполнили отправку одной сессии - да или нет
Количество попыток отправки письма (число) - если выбрано более 1 письма за 1 сессию отправлять с аккаунта.
*Сессия это когда запустилась отправка писем, включается счетчик на каждом аккаунте сколько он отправил.
счетчик можно скинуть по отдельной кнопке "Скинуть счетчики отправок для аккаунтов"
Таймаут ответа сервера (в секундах).
Пауза между отправками одного потока (в секундах).
Количество получателей одного письма (одновременных).
Метод добавления получателей:
всех в CC, BCC или TO (выбор из списка);
опция «Все получатели в CC/BCC, кроме первого» (первый указывается в TO, остальные – в выбранное поле).
Проверка качества доставки:
каждые N отправленных писем (общее количество со всех аккаунтов) письмо отправляется на указанный email-адрес для проверки.

Вкладка «База e-mail»
Используется для загрузки базы адресов получателей.
Формат загружаемой базы (выбирается перед загрузкой):
Имя <login@domen.ru>
Имя <login@domen.ru>;
login@domen.ru
Загрузка базы:
выбирается файл;
база сохраняется в MySQL.
Обработка загруженных данных:
если выбран формат 1 или 2, но имя отсутствует (<login@domen.ru> или <login@domen.ru>;),
в БД сохраняется только email,
имя определяется как часть логина до знака @ (например, login).

Вкладка «Макросы»
На вкладке отображается таблица всех доступных макросов в формате {{$name_macros}}. Где бы макрос ни был вставлен, при генерации письма он заменяется на актуальное значение.
Кнопка «Добавить макрос»
При нажатии открывается форма (JS) для создания нового макроса:
Имя макроса.
Частота изменения значения:
«Менять значение каждые N писем» (при значении 1 макрос будет обновляться в каждом письме, создаваемом системой, а не раз в N отправок).
Типы макросов (вкладки в форме):
1. Генератор
Тип генерации:
Счётчик:
начальное значение (число);
шаг увеличения (на сколько увеличивать при каждом использовании).
Рандомизация:
набор символов для генерации (указывается вручную);
длина результата (диапазон: от… до… символов).
Кнопка «ТЕСТ» – выводит пример сгенерированного значения.
2. Готовое (списки)
Выбор текстового файла для генерации значений, тектстовый файл загружается в базу данных, данные в нем построчно находятся.
Т.е. список загружаем из файла, в нем в каждой строке есть запись (слова, предложения, что угодно). Все это после загрузки сохраняется в базу данных в виде списка.
Настройки выбора данных из списка:
Что брать из списка: строки / слова / предложения (как определить что это предложение догадаешься написать логику сам);
Как брать: рандомно (берет с разных строк) / последовательно (может брать если выбрано брать только строки т.е. целиком). т.е. если выбрано слова или предложения то они могут браться только рандомно из разных строк списка.
Параметры генерации текста:
слов в предложении (от… до…);
предложений в абзаце (от… до…);
абзацев (от… до…).
Формирование HTML (написать свой генератор HTML кода со стилями таблицами и тд):
возможность добавлять текст в HTML;
задавать размер HTML (в КБ, от… до…).
Кнопка «ТЕСТ» – предварительный просмотр результата.
3. Мультимакрос
Поле «Выражение» – позволяет комбинировать:
другие макросы;
собственный текст.
Кодирование результата:
Base64;
QUOTED-PRINTABLE;
без кодирования.
Кнопка «ТЕСТ» – проверка результата с учётом всех настроек.

Вкладка «Прокси»
Загрузка текстового файла с прокси в формате:
190.2.142.30:11197
217.23.2.4:14031
109.236.81.34:12824
Все прокси сохраняются в базу данных для дальнейшего использования системой.

Аккаунты должны работать с прокси, 1 аккаунт берет в работу 1 прокси, для прокси ставится метка что он взят уже аккаунтом чтобые его никто уже не брал, когда на всех прокси проставятся метки - сбрасывать все метки, чтобы снова их можно было брать.
Прокси перед тем как начать работу должны проверяться, ну например на любой сайт где можно получить свой ip адрес, есть много таких где делается get запрос и возвращаются данные в json. Вот пусть так прокси и проверяются, если рабочий - то берет его в работу, если нет - пропускаем.

Также при работае с аккаунтами прокси может протухнуть, делается 3 попытки, если безуспешные и нет ответа от сервера - берет другой прокси и так пока не найдется рабочий.

Вкладка «Аттачи»:

На вкладке отображается таблица со всеми вложениями. Вложения могут быть различных типов: pdf, docx, изображения (png, jpg, gif).
Кнопка «Добавить макрос» – при нажатии открывается форма добавления вложения, где необходимо:
Указать имя вложения (для себя) и имя файла для отправки (можно использовать макросы для рандомизации имени; по умолчанию применяется макрос {{$const_attach_1_name_file}}, генерирующий уникальное имя вида NSKFH86SU_63958J86DH – каждый раз разной длины и содержания).
выбрать тип вложения (изображение "png/jpg/gif", "docx", "pdf", "другой").
Если выбрано изображение:
необходимо указать, использовать ли рандомизацию.
при включенной рандомизации задаются параметры:
добавление случайных отступов (пиксели «слева от… до…», «справа…», «сверху…», «снизу…»);
наложение случайных цветных точек по всей картинке (16-цветная палитра, с возможностью указания диапазона количества точек).
Также выбирается способ отправки изображения:
внутри письма – генерируется уникальный макрос вложения с кодом, который можно редактировать в отдельном поле. Пример кода:
<img src="data:image/png;base64,{{$img_1_base64}}">
Здесь {{$img_1_base64}} – base64-код изображения после всех обработок.
Также у настройки "внутри письма" есть еще одна настройка (галочка) для указания - загружать на сервер или нет? Если нет - то мы просто получим base64 картинки и код для вставки, если же загружать на сервер, то он прикрепится к письму как обычный аттач.
как прикреплённый файл – отправляется как вложение без встраивания в тело письма.
Если выбран docx:
есть возможность добавить в конец документа N случайных страниц (от… до…) и указать их содержимое (в том числе вставить существующие макросы), содержимое макросов вставляется всегда в последнюю страницу;
можно выбрать, преобразовывать ли docx в pdf с генерацией случайных метаданных (дата создания, автор и др.), куда также можно вставить макросы;
в результате отправляется либо исходный docx, либо сгенерированный pdf.
Если выбран pdf или другой тип файла:
никаких дополнительных действий не требуется, файл отправляется как есть (тип "другой").

У каждого вложения должны быть собственные макросы для вставки в HTML-код письма (в текст сообщения), включающие id и url. Эти значения возвращаются сервером после загрузки файла. Для каждого вложения макросы должны иметь уникальные названия. В разделе «Аттачи» в таблице необходимо отображать соответствующие макросы, чтобы их можно было скопировать и вставить в текст письма. Также они должны отображаться в разделе Письмо когда мы выбираем какие аттачи прикрепить к письму.

Вкладка «Аккаунты API»
Используется для загрузки и хранения в базе данных учетных записей с API-ключами.
Формат загружаемого файла (текстовый):
login@domen.ru:password:Имя:Фамилия:API_KEY:uuid
Пример:
tabganagiosulper@domen.ru:tfqFAB*5dbWT2:Маргарита:Рогова:2.2180593733.109590.1777935493.1746399493190.1.0.10073308.yQiZHFGxGaEyd2Q0.KcgP5JD12BATAnB0a8tp2nueVttZ0hgR7SPB140i9a3eYGW8z567i7a--3N84JhfW6vKfnwYljzDAmz5Gt--Bplndrm0HAKOYOs5X4I7jyaWYN9yr5YX.kXjXIfca_JSsBX7tJMd8NA:55a85d4553b5198bc83c4481a601d680
Структура данных:
Логин – login@domen.ru
Пароль – password
Имя – Имя
Фамилия – Фамилия
API-ключ – API_KEY
uuid аккаунта - uuid
Обработка данных:
Пользователь загружает текстовый файл.
Система парсит каждую строку, разделяя данные по символу :.
Все данные сохраняются в базу данных для дальнейшего использования.

Техническая часть работы с API:

когда аккаунт начинает работу, он должен проверить - живой или нетдля этого он делает запрос GET
по этому адресу https://mail.domen.ru/api/mobile/v1/reset_fresh?app_state=active&uuid={{$uuid}}
где макрос {{$uuid}} берется из аккаунта т.е. значение uuid

Заголовки GET запроса такие:

Host: mail.domen.ru
Accept: */*
Content-Type: application/x-www-form-urlencoded
Authorization: OAuth {{$API_KEY}}
Accept-Encoding: gzip, deflate, br
User-Agent: ru.XXXX.XXXX/XXXX.XXXX (iPhone12,1; iOS 16.5.1)
Content-Length: 0
Accept-Language: ru-RU;q=1, en-RU;q=0.9

где {{$API_KEY}} это разумеется api аккаунта.

Ответ должен быть таким:
{
    "status": {
        "status": 1
    }
}
Значит аккаунт ЖИВОЙ, отлично, можно с ним работать.


2. Загрузка вложения (аттача)

POST-запрос:
https://mail.domen.ru/api/mobile/v1/upload?app_state=foreground&uuid={{$uuid}}&client=iphone

Заголовки:

Host: mail.domen.ru
Accept: */*
Content-Type: application/x-www-form-urlencoded
Authorization: OAuth {{$API_KEY}}
Accept-Encoding: gzip, deflate, br
User-Agent: ru.XXXX.XXXX/XXXX.XXXX (iPhone12,1; iOS 16.5.1)
Content-Type: multipart/form-data; boundary=685ff361-facc-4e4d-8f94-e8c205c61e48
Accept-Encoding: gzip, deflate, br

Тело запроса (пример):

--685ff361-facc-4e4d-8f94-e8c205c61e48
Content-Disposition: form-data; name="filename"
Content-Transfer-Encoding: binary
Content-Type: text/plain; charset=UTF-8
Content-Length: 35

Анкета.pdf
--685ff361-facc-4e4d-8f94-e8c205c61e48
Content-Disposition: form-data; name="attachment"; filename="Анкета.pdf"
Content-Type: application/octet-stream
Content-Length: 1260969

%PDF-1.5
%µµµµ
1 0 obj
1260783
%%EOF
--685ff361-facc-4e4d-8f94-e8c205c61e48--


Передаётся в формате multipart/form-data, включает:

filename – имя файла;

attachment – бинарное содержимое файла.

Ответ при успешной загрузке:
{
    "status": { "status": 1 },
    "id": "YWVzX3NpZDp7ImFlc0tleUlkIjoiMTc4IiwiaG1hY0tleUlkIjoiMTc4IiwiaXZCYXNlNjQiOiJ2WTRzWm9pOGR2V05Odi9LeHVjeFRnPT0i,...",
    "hash": "l2NBp4RNPgLK22t3dAAvn76ASI/zEZbgQY+rpP08JHtUF4GQl+W2nPpOk+9joITwqQfcwKxpasB6fEwymbxEGg==",
    "content_type": "application/octet-stream",
    "url": "https://webattach.mail.domen.net/message_part_real?...",
    "type": "general"
}


Тут надо нам взять id (идентификатор аттача) и url (прямая ссылка к загруженному файлу) они понадобятся нам чтобы отправлять аттач в письме, их может быть тут 2 или 3 у каждого аттача будет свой id и url (если крепим несолько файлов конечно - запоминаем для каждого свои данные).

В письме чтобы отправить надо вот так сделать POST запрос:

На адрес https://mail.domen.ru/api/mobile/v1/send?app_state=foreground&uuid={{$uuid}}

Заголовки:

Host: mail.domen.ru
Accept: */*
Content-Type: application/json
Accept-Language: ru-RU;q=1
Authorization: OAuth {{$API_KEY}}
X-Request-Timeout: 180000
User-Agent: ru.XXXX.XXXX/XXXX.XXXX (iPhone12,1; iOS 16.5.1)
Accept-Encoding: gzip, deflate
Connection: close

Тело:

{
  "att_ids" : ["{{$url_attach_1}}"],
  "attachesCount": 1,
  "send" : "<div><img src=\"{{$url_attach_2}}\"><\/div><br><br>--<br>С уважением, {-Variable.from_name-}",
  "ttype" : "html",
  "subj" : "Тема сообщения, Tiket № 0987098098",
  "operation_id" : "{-Variable.operation_id-}",
  "compose_check" : "{-Variable.composecheck-}",
  "from_mailbox" : "{-Variable.login-}@domen.com",
  "bcc" : "{-Variable.str_sendmail_posget-}",
  "from_name" : "{-Variable.from_name-}"
}

После успешной отправки мы должны получить от сервера ответ: {    "status": {        "status": 1    }}


Это у нас конечно в форме "Текст сообщения" будет:

<div><img src=\"{{$url_attach_2}}\"><\/div><br><br>--<br>С уважением, {-Variable.from_name-}

Где у нас на примере {{$url_attach_2}} - аттач 2 в виде изображения, крепится к письму как внутри письма но с загрузкой на сервер в надстройках аттача, поэтому он загрузился и мы получили от него url.
{{$url_attach_1}} - это у нас pdf (который мы загрузили после генерации docx в pdf ну или же просто прикрепили как готовый pdf), у него нет надстроек как у картинки выбирать загружать на сервер или нет - он всегда будет загружен и прикреплен (в json видно как это делается).
После загрузки аттачей мы получили их url и использовали в отправке письма.


В теле отправки письма я указал только bcc как получателей, но там могут быть также to или даже одновременно to и bcc, или to, cc или просто cc.
Тут в примере из другого проекта другой тип переменных но ты поймешь что туда надо вставлять свои перменные, например {-Variable.from_name-} имя отправителя, {-Variable.str_sendmail_posget-} получатели формата \"atos2895@ya.ru\" <atos2895@ya.ru>; \"prosaccupneriru@domen.ru\" <prosaccupneriru@domen.ru> ну это для json форматирование как пример 2 получателя, получатели разделены точкой с запятой, последний точку с запятой иметь не должен.

{-Variable.login-}@domen.com - это у нас логин аккаунта в данном случае из нашего выше примера это tabganagiosulper@domen.ru

{-Variable.operation_id-} id операции

id операции получается так:
(он всегда перед отправкой письма должен получаться новый с сервера)

GET запрос:

https://mail.domen.ru/api/mobile/v2/generate_operation_id?app_state=foreground&uuid={{$uuid}}&client=iphone

Host: mail.domen.ru
Accept: */*
Content-Type: application/x-www-form-urlencoded
Authorization: OAuth {-Variable.access_token-}
Accept-Encoding: gzip, deflate
User-Agent: ru.XXXX.XXXX/XXXX.XXXX (iPhone12,1; iOS 16.5.1)
Content-Length: 0
Accept-Language: ru-RU;q=1
Connection: close


Разумеется должна быть еще вкладка НАСТРОЙКИ:

Там чтобы можно было прописать домен куда api будет делать запросы. Ато в нашем случае это domen.ru
Также чтобы там можно было сменить старый пароль администратора на другой.

Панель должна работать быстро и поддерживать тысячи соединения работать с ними легко, делать тысячи post get запросов.
Также чтобы там можно было сменить старый пароль администратора на другой.

Панель должна работать быстро и поддерживать тысячи соединения работать с ними легко, делать тысячи post get запросов.
